<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Tab</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDKs (Kept for Auth/Future use, but Chat removed) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase Variables
        let db, auth, appId;
        
        // Initialize Firebase
        try {
            if (typeof __firebase_config !== 'undefined') {
                const firebaseConfig = JSON.parse(__firebase_config);
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

                // Auth Flow
                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (error) {
                        console.log("Auth skipped (Local/Restricted Mode)");
                    }
                };
                
                initAuth();
                window.firebaseReady = true;
            }
        } catch (e) {
            console.log("Firebase not configured");
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&family=Indie+Flower&display=swap');

        :root {
            --glass: rgba(20, 20, 20, 0.6);
            --glass-hover: rgba(40, 40, 40, 0.8);
            --glass-border: rgba(255, 255, 255, 0.1);
            --neon-color: #10b981; /* Default Emerald Green */
            --bg-glow: rgba(16, 185, 129, 0.15);
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #000;
            color: #e2e8f0;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        .brand-font { font-family: 'Orbitron', sans-serif; }

        /* CURSOR STYLES */
        body.cursor-crosshair { cursor: crosshair; }
        body.cursor-text { cursor: text; }
        body.cursor-move { cursor: move; }
        body.cursor-help { cursor: help; }
        body.cursor-pointer { cursor: pointer; }

        /* LAYERS */
        #custom-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -4;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        /* 2. Base Gradient (Default BG) */
        #base-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -3;
            background: radial-gradient(circle at 50% 120%, var(--bg-glow) 0%, #050505 60%, #000 100%);
        }

        /* 3. Particles */
        #particle-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            pointer-events: none;
        }

        /* 4. Waves */
        .wave-container {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            pointer-events: none;
        }
        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 100%;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNDQwIDMyMCI+PHBhdGggZmlsbD0icmdiYSgyNTUsIDI1NSwgMjU1LCAwLjAzKSIgZD0iTTAgMTYwQzQ4MCAzMjAgOTYwIDAgMTQ0MCAxNjBWMzIwSDBaIj48L3BhdGg+PC9zdmc+');
            background-repeat: repeat-x;
            background-size: 50% 100%;
            transform-origin: center bottom;
        }
        .wave1 { animation: moveWave 20s linear infinite; z-index: 10; opacity: 0.2; height: 50vh; }
        .wave2 { animation: moveWave 30s linear infinite; z-index: 9; opacity: 0.1; height: 65vh; bottom: -10vh; animation-delay: -5s; }
        
        @keyframes moveWave {
            0% { transform: translateX(0) scaleY(1); }
            50% { transform: translateX(-25%) scaleY(0.9); }
            100% { transform: translateX(-50%) scaleY(1); }
        }

        /* CUSTOM TEXT FADE IN */
        @keyframes textFadeIn {
            0% { opacity: 0; transform: translate(-50%, -10px); }
            100% { opacity: 1; transform: translate(-50%, 0); }
        }

        /* RAINBOW ANIMATION (Konami) */
        @keyframes rainbow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
        .rainbow-mode {
            animation: rainbow 5s linear infinite;
        }

        /* SECTIONS */
        .section {
            display: none;
            height: 100%;
            width: 100%;
            flex-direction: column;
            animation: fadeIn 0.3s ease-out;
            padding-top: 60px;
        }
        .section.active { display: flex; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }

        /* NAVBAR */
        .navbar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 50;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
        }

        /* MENU BUTTONS */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            max-width: 1000px;
            width: 100%;
            margin: auto;
            padding: 0 20px;
        }
        
        .menu-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            aspect-ratio: 1/1;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 0 15px rgba(0,0,0,0.3), inset 0 0 20px var(--bg-glow);
        }
        .menu-card:hover {
            background: var(--glass-hover);
            transform: translateY(-5px) scale(1.05);
            border-color: var(--neon-color);
            box-shadow: 0 0 30px var(--bg-glow);
        }
        .menu-card i { 
            font-size: 3rem; 
            margin-bottom: 15px; 
            color: #eee; 
            text-shadow: 0 0 10px var(--neon-color);
        }
        .menu-card span { font-weight: bold; letter-spacing: 1px; color: #fff; }

        /* GAMES CONTAINER (Scroll Handling) */
        .games-scroll-container {
            flex-grow: 1;
            overflow-y: auto;
            padding-bottom: 100px;
        }

        /* FAVORITES SECTION */
        .favorites-section {
            padding: 20px 30px 0 30px;
        }
        .section-title {
            font-size: 0.8rem;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 5px;
            font-weight: bold;
        }
        
        /* SCROLLBAR HIDE UTILITY */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* GAME GRID */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            padding: 20px 30px;
        }

        .game-card {
            background: #222;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s;
            border: 1px solid #333;
        }
        .game-card:hover {
            transform: scale(1.05);
            border-color: var(--neon-color);
            box-shadow: 0 0 15px var(--bg-glow);
            z-index: 10;
        }
        
        .fav-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            z-index: 20;
            color: rgba(255,255,255,0.3);
            transition: color 0.2s;
            padding: 5px;
        }
        .fav-btn:hover, .fav-btn.active {
            color: #ef4444; /* Red Heart */
            text-shadow: 0 0 10px #ef4444;
        }

        /* PLAYER & HOVER HEADER (Fixed Fade Effect) */
        .player-frame {
            flex-grow: 1;
            width: 100%;
            height: 100%;
            background: #000;
            border: none;
        }
        
        .player-header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
            padding: 0 20px;
            z-index: 60;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none; /* Click through when hidden */
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Invisible Trigger Zone */
        .player-trigger {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 30px;
            z-index: 61;
        }

        /* Logic: Hovering trigger OR header keeps header visible */
        .player-trigger:hover ~ .player-header,
        .player-header:hover {
            opacity: 1;
            pointer-events: auto;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(5px);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
        .modal.open { display: flex; }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--neon-color); }

        /* THEME & SETTINGS */
        .theme-btn { 
            width: 40px; 
            height: 40px; 
            border-radius: 50%; 
            cursor: pointer; 
            border: 2px solid transparent; 
            transition: transform 0.2s;
        }
        .theme-btn:hover { transform: scale(1.1); border-color: white; }
        
        .glow-text {
            color: var(--neon-color);
            text-shadow: 0 0 10px var(--bg-glow);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #4b5563;
            transition: .4s;
            border-radius: 24px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--neon-color); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* CALENDAR */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            text-align: center;
            font-size: 0.8rem;
        }
        .calendar-day {
            padding: 5px;
            border-radius: 5px;
            background: rgba(255,255,255,0.05);
        }
        .calendar-today {
            background: var(--neon-color);
            color: black;
            font-weight: bold;
        }
        
        /* SHOP MODAL SPECIAL STYLE */
        #shopModal .modal-content {
             max-height: 80vh;
             overflow-y: auto;
        }

    </style>
</head>
<body>

    <!-- CUSTOM WALLPAPER LAYER -->
    <div id="custom-bg"></div>
    
    <!-- BASE BG -->
    <div id="base-bg"></div>

    <!-- PARTICLES (Now ABOVE base bg) -->
    <canvas id="particle-canvas"></canvas>

    <!-- WAVES (Topmost background layer) -->
    <div class="wave-container">
        <div class="wave wave1"></div>
        <div class="wave wave2"></div>
    </div>

    <!-- PANIC OVERLAY (Google Disguise) -->
    <div id="panic-overlay" class="fixed inset-0 bg-white z-[9999] hidden flex flex-col items-center justify-center font-arial">
        <div class="flex flex-col items-center w-full max-w-[600px]">
            <img src="https://www.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png" alt="Google" class="mb-8" width="272" height="92">
            <div class="w-full flex items-center border border-gray-200 rounded-full px-4 py-3 hover:shadow-md transition">
                <i class="fas fa-search text-gray-400 mr-3"></i>
                <input type="text" class="w-full outline-none text-gray-700 text-lg" placeholder="Search Google or type a URL">
                <img src="https://www.gstatic.com/images/branding/googlemic/2x/googlemic_color_24dp.png" class="h-6 ml-3 cursor-pointer">
            </div>
            <div class="mt-8 flex gap-4">
                <button class="bg-gray-100 hover:bg-gray-200 text-sm text-gray-800 px-4 py-2 rounded">Google Search</button>
                <button class="bg-gray-100 hover:bg-gray-200 text-sm text-gray-800 px-4 py-2 rounded">I'm Feeling Lucky</button>
            </div>
        </div>
    </div>

    <!-- NAVBAR -->
    <div class="navbar">
        <div class="flex items-center gap-3 cursor-pointer pt-2" onclick="goHome()">
            <i class="fas fa-leaf text-2xl" style="color: var(--neon-color)"></i>
            <span class="text-xl font-bold brand-font text-white tracking-widest">GARDEN<span class="glow-text">SPOT</span></span>
        </div>
        
        <!-- SPLASH TEXT (Centered in Navbar) -->
        <div id="splash-text" class="absolute left-1/2 transform -translate-x-1/2 text-gray-400 font-mono text-xs md:text-sm text-center px-4 select-none whitespace-nowrap overflow-hidden text-ellipsis max-w-[40%] hidden md:block opacity-0 hover:text-white transition-colors" style="animation: textFadeIn 2s ease-out forwards; text-shadow: 0 0 5px var(--neon-color);" title="Double-click to edit">
            Loading...
        </div>

        <div class="flex items-center gap-4 text-gray-400 text-sm font-mono">
            <div id="wifi-icon"><i class="fas fa-wifi"></i></div>
            <div id="battery-level" class="flex items-center gap-1 hidden"><i class="fas fa-battery-full"></i> <span>100%</span></div>
            <div id="clock">12:00</div>
        </div>
    </div>

    <!-- 1. HOME SECTION -->
    <div id="section-home" class="section active items-center justify-center">
        <div class="menu-grid">
            <div class="menu-card" onclick="navTo('games')">
                <i class="fas fa-gamepad"></i>
                <span>GAMES</span>
            </div>
            <div class="menu-card" onclick="navTo('apps')">
                <i class="fas fa-cubes"></i>
                <span>APPS</span>
            </div>
            <div class="menu-card" onclick="navTo('music')">
                <i class="fas fa-music"></i>
                <span>MUSIC</span>
            </div>
            <div class="menu-card" onclick="navTo('unblocker')">
                <i class="fas fa-globe"></i>
                <span>UNBLOCKER</span>
            </div>
            <div class="menu-card" onclick="navTo('account')">
                <i class="fas fa-user-circle"></i>
                <span>ACCOUNT</span>
            </div>
            <div class="menu-card" onclick="navTo('settings')">
                <i class="fas fa-cog"></i>
                <span>SETTINGS</span>
            </div>
        </div>
        <div class="absolute bottom-10 text-gray-500 text-center">
            <div class="text-xs font-bold mb-1">GardenSpot OS v1.64</div>
            <div class="text-[10px] opacity-70 tracking-widest">By Pavlo</div>
        </div>
    </div>

    <!-- 2. GAMES LIBRARY -->
    <div id="section-games" class="section">
        <div class="px-8 py-4 flex flex-col md:flex-row justify-between items-center border-b border-white/10 bg-black/40 gap-4">
            <h2 class="text-2xl font-bold text-white brand-font">LIBRARY</h2>
            <div class="flex gap-3 items-center flex-wrap justify-center">
                <!-- Filter Dropdown -->
                <div class="relative">
                    <select id="gameFilter" onchange="renderGames()" class="bg-gray-900 border border-white/20 text-white text-xs rounded-lg px-3 py-1.5 focus:outline-none appearance-none pr-8 cursor-pointer hover:bg-gray-800 transition">
                        <option class="bg-gray-900 text-white" value="az">A - Z</option>
                        <option class="bg-gray-900 text-white" value="za">Z - A</option>
                        <option class="bg-gray-900 text-white" value="newest">Newest</option>
                        <option class="bg-gray-900 text-white" value="oldest">Oldest</option>
                        <option class="bg-gray-900 text-white" value="popular">Popular</option>
                    </select>
                    <i class="fas fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-xs text-gray-400 pointer-events-none"></i>
                </div>

                <input type="text" id="searchInput" placeholder="Search..." 
                    class="bg-white/10 border border-white/20 rounded-full px-4 py-1 text-white focus:outline-none w-40 text-sm"
                    style="border-color: var(--neon-color)">
                
                <button onclick="openAddModal()" class="text-white px-4 py-1 rounded-full font-bold transition text-sm flex items-center gap-2"
                    style="background-color: var(--neon-color); box-shadow: 0 0 10px var(--bg-glow)">
                    <i class="fas fa-plus"></i> ADD
                </button>
            </div>
        </div>

        <!-- SCROLLABLE CONTENT WRAPPER -->
        <div class="games-scroll-container">
            <!-- Favorites Section -->
            <div id="favoritesSection" class="favorites-section hidden">
                <div class="section-title">Favorites</div>
                <div id="favoritesGrid" class="flex gap-4 overflow-x-auto pb-4 scrollbar-hide">
                    <!-- Favorites injected here -->
                </div>
            </div>

            <!-- Main Grid -->
            <div id="gameGrid" class="game-grid">
                <!-- Games injected here -->
            </div>
        </div>
    </div>

    <!-- 3. APPS LIBRARY -->
    <div id="section-apps" class="section">
        <div class="px-8 py-4 flex justify-between items-center border-b border-white/10 bg-black/40 gap-4">
            <h2 class="text-2xl font-bold text-white brand-font">APPS</h2>
            <button onclick="goHome()" class="text-gray-400 hover:text-white px-3 py-1 rounded border border-gray-600 hover:bg-white/10 transition text-sm">Back</button>
        </div>
        
        <div id="appsGrid" class="game-grid">
            <!-- Apps injected here via JS -->
        </div>
    </div>

    <!-- 3.1 NOTEPAD SECTION -->
    <div id="section-notepad" class="section items-center justify-center">
        <div class="bg-black/60 p-6 rounded-2xl border border-white/10 w-full max-w-4xl h-[85vh] flex flex-col relative">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-3">
                    <i class="fas fa-sticky-note text-xl" style="color: var(--neon-color)"></i>
                    <h2 class="text-2xl text-white font-bold brand-font">Notepad</h2>
                </div>
                <div class="flex gap-2">
                    <span id="saveStatus" class="text-xs text-gray-400 italic self-center mr-2"></span>
                    <button onclick="goHome()" class="text-gray-400 hover:text-white px-3 py-1 rounded border border-gray-600 hover:bg-white/10 transition text-sm">Back</button>
                </div>
            </div>
            <textarea id="notepadArea" class="flex-grow bg-gray-900/80 text-white p-4 rounded-lg outline-none font-mono resize-none border border-white/10 focus:border-blue-500/50" placeholder="Type your notes here... They auto-save!"></textarea>
        </div>
    </div>

    <!-- 3.2 SYSTEM SPECS SECTION -->
    <div id="section-specs" class="section items-center justify-center">
        <div class="bg-black/60 p-6 rounded-2xl border border-white/10 w-full max-w-2xl flex flex-col relative">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <i class="fas fa-microchip text-xl" style="color: var(--neon-color)"></i>
                    <h2 class="text-2xl text-white font-bold brand-font">System Specs</h2>
                </div>
                <button onclick="goHome()" class="text-gray-400 hover:text-white px-3 py-1 rounded border border-gray-600 hover:bg-white/10 transition text-sm">Back</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm font-mono" id="specsGrid">
                <!-- Injected via JS -->
            </div>
        </div>
    </div>

    <!-- 3.5 MUSIC SECTION -->
    <div id="section-music" class="section items-center justify-center">
        <div class="bg-black/60 p-4 rounded-2xl border border-white/10 w-full max-w-6xl h-[85vh] flex flex-col relative">
             <div class="flex justify-between items-center mb-4 px-2">
                <div class="flex items-center gap-3">
                    <i class="fas fa-music text-xl" style="color: var(--neon-color)"></i>
                    <h2 class="text-2xl text-white font-bold brand-font">Music Player</h2>
                </div>
                <button onclick="goHome()" class="text-gray-400 hover:text-white px-3 py-1 rounded border border-gray-600 hover:bg-white/10 transition">Back</button>
            </div>
            <div class="flex-grow bg-black rounded-lg overflow-hidden border border-white/5">
                 <iframe src="https://bi6music.netlify.app/home" class="w-full h-full border-0" allow="autoplay; encrypted-media">Loadingâ€¦</iframe>
            </div>
        </div>
    </div>

    <!-- 4. UNBLOCKER -->
    <div id="section-unblocker" class="section items-center justify-center">
        <div class="bg-black/60 p-8 rounded-2xl border border-white/10 w-full max-w-lg text-center">
            <i class="fas fa-user-secret text-5xl mb-4" style="color: var(--neon-color)"></i>
            <h2 class="text-2xl text-white font-bold mb-2">Web Proxy</h2>
            <p class="text-xs text-gray-400 mb-4">
                Access blocked sites through this secure gateway.
            </p>
            
            <div class="flex flex-col gap-3">
                <button onclick="launchGame('Proxy', 'https://wiki.jimmyqrg.com')" class="w-full text-white px-6 py-3 rounded font-bold transition hover:scale-105 shadow-lg shadow-emerald-500/20 flex items-center justify-center gap-2" style="background-color: var(--neon-color)">
                    <i class="fas fa-rocket"></i> Launch Embedded
                </button>
                <button onclick="openUrlInBlank('https://wiki.jimmyqrg.com')" class="w-full bg-gray-700 hover:bg-gray-600 text-white px-6 py-3 rounded font-bold transition hover:scale-105 flex items-center justify-center gap-2">
                    <i class="fas fa-external-link-alt"></i> Launch Cloaked
                </button>
            </div>
            
            <button onclick="goHome()" class="mt-4 text-gray-400 hover:text-white text-sm">Back to Home</button>
        </div>
    </div>

    <!-- 5. SETTINGS -->
    <div id="section-settings" class="section items-center justify-center">
        <div class="bg-black/60 p-8 rounded-2xl border border-white/10 w-full max-w-md h-[80vh] overflow-y-auto custom-scrollbar">
            <h2 class="text-2xl text-white font-bold mb-6 border-b border-white/10 pb-2 flex justify-between items-center">
                Settings
            </h2>
            
            <!-- VISUALS GROUP -->
            <h3 class="text-gray-400 text-xs font-bold uppercase mb-2 mt-4">Visuals</h3>
            
            <!-- Theme -->
            <div class="mb-4">
                <div class="flex flex-col gap-4">
                    <div class="flex gap-4 justify-center">
                        <div class="theme-btn bg-emerald-500 shadow-lg shadow-emerald-500/50" onclick="setTheme('#10b981')"></div>
                        <div class="theme-btn bg-blue-500 shadow-lg shadow-blue-500/50" onclick="setTheme('#3b82f6')"></div>
                        <div class="theme-btn bg-purple-500 shadow-lg shadow-purple-500/50" onclick="setTheme('#a855f7')"></div>
                        <div class="theme-btn bg-red-500 shadow-lg shadow-red-500/50" onclick="setTheme('#ef4444')"></div>
                        <div class="theme-btn bg-yellow-500 shadow-lg shadow-yellow-500/50" onclick="setTheme('#eab308')"></div>
                    </div>
                    <!-- Custom Color Picker -->
                    <div class="flex items-center gap-3 bg-black/40 p-2 rounded border border-white/10">
                        <input type="color" id="customColorPicker" class="w-8 h-8 rounded cursor-pointer border-none bg-transparent p-0" oninput="setTheme(this.value)">
                        <span class="text-xs text-gray-400">Custom Color</span>
                    </div>
                </div>
            </div>

            <!-- Custom Wallpaper Settings -->
            <div class="mb-4 bg-black/30 p-3 rounded-lg border border-white/5">
                <span class="text-gray-300 font-bold text-xs uppercase tracking-wider block mb-2">Custom Wallpaper</span>
                <input type="text" id="wallpaperInput" placeholder="Paste Image URL..." class="w-full bg-black/50 border border-gray-600 p-2 rounded text-white text-xs outline-none focus:border-white mb-2">
                <div class="flex gap-2">
                    <button onclick="saveWallpaper()" class="flex-1 py-1 bg-blue-600/50 hover:bg-blue-600 text-white text-xs rounded transition">Apply</button>
                    <button onclick="clearWallpaper()" class="flex-1 py-1 bg-red-600/50 hover:bg-red-600 text-white text-xs rounded transition">Clear</button>
                </div>
            </div>

            <!-- Custom Cursors -->
            <div class="mb-4 bg-black/30 p-3 rounded-lg border border-white/5">
                <span class="text-gray-300 font-bold text-xs uppercase tracking-wider block mb-2">Cursor Style</span>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="setCursor('')" class="bg-white/5 hover:bg-white/10 p-2 rounded text-xs text-gray-300">Default</button>
                    <button onclick="setCursor('cursor-crosshair')" class="bg-white/5 hover:bg-white/10 p-2 rounded text-xs text-gray-300 cursor-crosshair">Crosshair</button>
                    <button onclick="setCursor('cursor-text')" class="bg-white/5 hover:bg-white/10 p-2 rounded text-xs text-gray-300 cursor-text">Text</button>
                    <button onclick="setCursor('cursor-move')" class="bg-white/5 hover:bg-white/10 p-2 rounded text-xs text-gray-300 cursor-move">Move</button>
                    <button onclick="setCursor('cursor-help')" class="bg-white/5 hover:bg-white/10 p-2 rounded text-xs text-gray-300 cursor-help">Help</button>
                </div>
            </div>

            <!-- Particles Toggle -->
            <div class="flex justify-between items-center bg-black/30 p-3 rounded-lg border border-white/5">
                <span class="text-gray-300 font-bold text-xs uppercase tracking-wider">Moving Particles</span>
                <label class="switch">
                    <input type="checkbox" id="particleToggle" checked onchange="toggleParticles()">
                    <span class="slider"></span>
                </label>
            </div>


            <!-- INTERFACE GROUP -->
            <h3 class="text-gray-400 text-xs font-bold uppercase mb-2 mt-4">Interface</h3>

            <!-- Clock Settings -->
            <div class="mb-4 flex justify-between items-center bg-black/30 p-3 rounded-lg border border-white/5">
                <span class="text-gray-300 font-bold text-xs uppercase tracking-wider">24-Hour Clock</span>
                <label class="switch">
                    <input type="checkbox" id="clockToggle" onchange="toggleClockFormat()">
                    <span class="slider"></span>
                </label>
            </div>

            <!-- Splash Text Settings -->
            <div class="mb-4 flex justify-between items-center bg-black/30 p-3 rounded-lg border border-white/5">
                <span class="text-gray-300 font-bold text-xs uppercase tracking-wider">Splash Messages</span>
                <label class="switch">
                    <input type="checkbox" id="splashToggle" checked onchange="toggleSplashText()">
                    <span class="slider"></span>
                </label>
            </div>
            
            <!-- Fullscreen Mode -->
            <div class="flex justify-between items-center bg-black/30 p-3 rounded-lg border border-white/5">
                <span class="text-gray-300 font-bold text-xs uppercase tracking-wider">Fullscreen Mode</span>
                <button onclick="toggleGlobalFullscreen()" class="text-white hover:text-blue-400 transition" title="Toggle Fullscreen">
                    <i class="fas fa-expand text-xl"></i>
                </button>
            </div>


            <!-- STEALTH GROUP -->
            <h3 class="text-gray-400 text-xs font-bold uppercase mb-2 mt-4">Stealth & Privacy</h3>

            <!-- Tab Cloaking -->
            <div class="mb-4 bg-black/30 p-3 rounded-lg border border-white/5">
                <span class="text-gray-300 font-bold text-xs uppercase tracking-wider block mb-2">Tab Cloaking</span>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="cloakTab('drive')" class="bg-white/5 hover:bg-white/10 p-2 rounded text-xs text-gray-300">Drive</button>
                    <button onclick="cloakTab('classroom')" class="bg-white/5 hover:bg-white/10 p-2 rounded text-xs text-gray-300">Classroom</button>
                    <button onclick="cloakTab('canvas')" class="bg-white/5 hover:bg-white/10 p-2 rounded text-xs text-gray-300">Canvas</button>
                    <button onclick="cloakTab('zoom')" class="bg-white/5 hover:bg-white/10 p-2 rounded text-xs text-gray-300">Zoom</button>
                    <button onclick="cloakTab('reset')" class="bg-red-900/30 hover:bg-red-900/50 p-2 rounded text-xs text-red-200 col-span-2">Reset</button>
                </div>
            </div>

             <!-- About:Blank Launcher -->
             <div class="mb-4 flex justify-between items-center bg-black/30 p-3 rounded-lg border border-white/5">
                <div class="flex flex-col">
                    <span class="text-gray-300 font-bold text-xs uppercase tracking-wider">About:Blank Cloak</span>
                    <span class="text-[10px] text-gray-500">Opens site in a hidden tab</span>
                </div>
                <button onclick="launchGlobalBlanker()" class="text-white hover:text-green-400 transition" title="Launch in About:Blank">
                    <i class="fas fa-external-link-alt text-xl"></i>
                </button>
            </div>

            <!-- Panic Button Settings -->
            <div class="bg-black/30 p-3 rounded-lg border border-white/5">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-300 font-bold text-xs uppercase tracking-wider">Panic Key</span>
                    <span id="currentPanicKey" class="text-xs font-mono bg-white/10 px-2 py-1 rounded text-white border border-white/10">~</span>
                </div>
                <button onclick="startKeyBinding()" id="bindKeyBtn" class="w-full py-2 border border-white/20 text-gray-300 text-xs rounded hover:bg-white/5 transition uppercase font-bold">Change Key</button>
            </div>
            
            <!-- SYSTEM GROUP -->
            <h3 class="text-gray-400 text-xs font-bold uppercase mb-2 mt-4">System</h3>

            <button onclick="openResetModal()" class="w-full py-2 bg-red-900/50 text-red-200 rounded hover:bg-red-800/50 mb-3 text-sm font-bold transition hover:scale-105 active:scale-95 border border-red-900">RESET ALL DATA</button>
            <button onclick="goHome()" class="w-full py-2 border border-gray-600 text-white rounded hover:bg-white/10 text-sm transition">Back</button>
        </div>
    </div>

    <!-- 7. ACCOUNT SECTION -->
    <div id="section-account" class="section items-center justify-center">
        <!-- LOGIN FORM -->
        <div id="login-form" class="bg-black/60 p-8 rounded-2xl border border-white/10 w-full max-w-sm text-center">
            <h2 class="text-2xl text-white font-bold mb-4 brand-font">Student Login</h2>
            <input id="loginName" type="text" placeholder="First Name" class="w-full bg-black/50 border border-gray-600 p-3 rounded text-white mb-3 outline-none focus:border-white">
            <input id="loginEmail" type="email" placeholder="Email (@student.elanco.org)" class="w-full bg-black/50 border border-gray-600 p-3 rounded text-white mb-4 outline-none focus:border-white">
            <p id="loginError" class="text-red-500 text-xs mb-4 hidden">Invalid email domain.</p>
            <button onclick="handleLogin()" class="text-white px-6 py-2 rounded font-bold w-full" style="background-color: var(--neon-color)">Sign In</button>
            <button onclick="goHome()" class="mt-4 text-gray-400 hover:text-white text-sm">Cancel</button>
        </div>

        <!-- PROFILE VIEW -->
        <div id="profile-view" class="bg-black/60 p-6 rounded-2xl border border-white/10 w-full max-w-4xl h-[85vh] hidden flex-col relative overflow-y-auto custom-scrollbar">
            <!-- Header -->
            <div class="flex justify-between items-center mb-6 border-b border-white/10 pb-4">
                <div class="flex items-center gap-4">
                    <div class="w-16 h-16 rounded-full bg-gray-700 flex items-center justify-center text-3xl font-bold text-white border-2 border-white/20 relative cursor-pointer hover:scale-105 transition hover:border-yellow-400" id="profileAvatar" onclick="openShop()" title="Change Profile Picture">
                        <!-- Icon injected here -->
                    </div>
                    <div>
                        <h2 class="text-2xl text-white font-bold brand-font" id="profileName">User Name</h2>
                        <div class="flex gap-4 text-xs mt-1">
                            <span class="text-gray-400" id="profileEmail">user@student.elanco.org</span>
                            <span class="text-yellow-400 font-bold"><i class="fas fa-coins mr-1"></i><span id="profileCoins">0</span> Coins</span>
                        </div>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button id="dailyRewardBtn" onclick="claimDailyReward()" class="bg-yellow-600/80 hover:bg-yellow-500 text-white px-3 py-1 rounded text-xs font-bold transition shadow-lg shadow-yellow-900/50 disabled:opacity-50 disabled:cursor-not-allowed">Claim Daily Reward (50 Coins)</button>
                    <button onclick="goHome()" class="text-gray-400 hover:text-white px-3 py-1 rounded border border-gray-600 hover:bg-white/10 transition text-sm">Back</button>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <!-- Level / XP -->
                <div class="bg-black/30 p-4 rounded-xl border border-white/5">
                    <h3 class="text-gray-300 font-bold text-sm uppercase mb-2">Level Progress</h3>
                    <div class="flex justify-between items-end mb-1">
                        <span class="text-4xl font-bold text-white brand-font" id="profileLevel">Lvl 1</span>
                        <span class="text-xs text-gray-400 mb-1" id="profileXP">0 XP</span>
                    </div>
                    <div class="w-full bg-gray-700 h-2 rounded-full overflow-hidden">
                        <div id="xpBar" class="h-full bg-blue-500 transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Calendar -->
                <div class="bg-black/30 p-4 rounded-xl border border-white/5">
                    <h3 class="text-gray-300 font-bold text-sm uppercase mb-2 text-center" id="calendarMonth">Calendar</h3>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Days injected via JS -->
                    </div>
                </div>
            </div>

            <!-- Achievements -->
            <div>
                <h3 class="text-gray-300 font-bold text-sm uppercase mb-3 border-b border-white/10 pb-1">Achievements</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="achievementsGrid">
                    <!-- Badges injected via JS -->
                </div>
            </div>
            
            <button onclick="handleLogout()" class="mt-8 text-red-400 text-xs hover:text-red-300 underline">Sign Out</button>
        </div>
    </div>

    <!-- 6. PLAYER (Fullscreen with Fade Menu) -->
    <div id="section-player" class="section bg-black fixed inset-0 z-[100] hidden pt-0">
        <!-- Invisible Trigger Zone -->
        <div class="player-trigger"></div>
        
        <!-- Fading Header -->
        <div class="player-header">
            <span class="text-gray-200 font-bold brand-font" id="playerTitle">Game</span>
            <div class="flex gap-2">
                <button onclick="openInBlank()" class="text-gray-300 hover:text-green-400 transition p-4 hover:bg-white/10 rounded-full" title="Open in Blank (Popout)">
                    <i class="fas fa-external-link-alt fa-lg"></i>
                </button>
                <button onclick="toggleFullscreen()" class="text-gray-300 hover:text-white transition p-4 hover:bg-white/10 rounded-full" title="Fullscreen">
                    <i class="fas fa-expand fa-lg"></i>
                </button>
                <button onclick="closeGame()" class="text-red-500 hover:text-red-300 transition p-4 hover:bg-red-500/10 rounded-full" title="Close">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
        </div>
        
        <!-- Tutorial Overlay -->
        <div id="player-tutorial" class="absolute inset-0 z-[70] bg-black/80 flex flex-col items-center justify-center text-center p-6 hidden">
            <div class="bg-gray-900 border border-white/20 p-8 rounded-2xl max-w-md shadow-2xl flex flex-col items-center">
                <i class="fas fa-arrow-up text-4xl text-blue-400 mb-4 animate-bounce"></i>
                <h2 class="text-2xl font-bold text-white mb-2 brand-font">Heads Up!</h2>
                <p class="text-gray-300 mb-6">The menu bar hides automatically to let you focus.</br>Hover your mouse at the <b>top of the screen</b> to show it again.</p>
                <button onclick="closeTutorial()" class="bg-blue-600 hover:bg-blue-500 text-white px-8 py-2 rounded-full font-bold transition shadow-lg shadow-blue-900/50">Got it</button>
            </div>
        </div>
        
        <!-- Iframe -->
        <iframe id="gameFrame" class="player-frame" src="about:blank" allowfullscreen></iframe>
    </div>

    <!-- ADD MODAL -->
    <div id="addModal" class="modal">
        <div class="bg-gray-900 border border-gray-700 p-6 rounded-xl w-full max-w-md shadow-2xl">
            <h2 class="text-xl text-white font-bold mb-4 brand-font">Add Game</h2>
            <input id="newTitle" type="text" placeholder="Title" class="w-full bg-black/50 border border-gray-600 p-2 rounded text-white mb-3 focus:outline-none focus:border-white">
            <input id="newUrl" type="text" placeholder="URL" class="w-full bg-black/50 border border-gray-600 p-2 rounded text-white mb-4 focus:outline-none focus:border-white">
            <div class="flex justify-end gap-3">
                <button onclick="closeAddModal()" class="text-gray-400 hover:text-white">Cancel</button>
                <button onclick="saveGame()" class="text-white px-4 py-2 rounded font-bold" style="background-color: var(--neon-color)">Save</button>
            </div>
        </div>
    </div>

    <!-- RESET CONFIRMATION MODAL -->
    <div id="resetModal" class="modal">
        <div class="bg-gray-900 border border-red-600/50 p-6 rounded-xl w-full max-w-md shadow-2xl text-center">
            <div class="flex justify-center mb-4">
                <div class="w-16 h-16 bg-red-900/30 rounded-full flex items-center justify-center border border-red-500/50">
                    <i class="fas fa-exclamation-triangle text-3xl text-red-500"></i>
                </div>
            </div>
            <h2 class="text-xl text-white font-bold mb-2 brand-font">Are you sure?</h2>
            <p class="text-gray-400 text-sm mb-6">
                This will delete all saved games, favorites, and theme settings. This action cannot be undone.
            </p>
            <div class="flex justify-center gap-3">
                <button onclick="closeResetModal()" class="px-4 py-2 text-gray-300 hover:text-white rounded border border-gray-600 hover:bg-gray-800 transition">Cancel</button>
                <button onclick="performReset()" class="px-6 py-2 bg-red-600 hover:bg-red-500 text-white font-bold rounded shadow-lg shadow-red-900/50 transition transform hover:scale-105">Yes, Reset Everything</button>
            </div>
        </div>
    </div>

    <!-- PASSWORD MODAL -->
    <div id="passwordModal" class="modal">
        <div class="bg-gray-900 border border-gray-700 p-6 rounded-xl w-full max-w-sm shadow-2xl text-center">
            <h2 class="text-xl text-white font-bold mb-4 brand-font">Enter Password</h2>
            <p class="text-xs text-gray-400 mb-4">This app is locked.</p>
            <input id="passwordInput" type="password" placeholder="Passcode" class="w-full bg-black/50 border border-gray-600 p-3 rounded text-white mb-4 outline-none focus:border-white text-center">
            <p id="passwordError" class="text-red-500 text-xs mb-4 hidden">Incorrect Password</p>
            <div class="flex gap-3 justify-center">
                <button onclick="closePasswordModal()" class="text-gray-400 hover:text-white text-sm">Cancel</button>
                <button onclick="checkPassword()" class="text-white px-6 py-2 rounded font-bold" style="background-color: var(--neon-color)">Unlock</button>
            </div>
        </div>
    </div>

    <!-- SHOP MODAL -->
    <div id="shopModal" class="modal">
        <div class="bg-gray-900 border border-gray-700 p-6 rounded-xl w-full max-w-4xl shadow-2xl relative flex flex-col h-[80vh]">
            <div class="flex justify-between items-center mb-4 border-b border-white/10 pb-2">
                <h2 class="text-xl text-white font-bold brand-font">Profile Shop</h2>
                <button onclick="closeShop()" class="text-gray-400 hover:text-white"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <div class="flex-grow overflow-y-auto custom-scrollbar p-2">
                <div class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 gap-4" id="shopGrid">
                    <!-- Shop Items injected here -->
                </div>
            </div>
            
            <div class="mt-4 pt-2 border-t border-white/10 flex justify-between items-center">
                <span class="text-yellow-400 font-bold"><i class="fas fa-coins mr-1"></i> <span id="shopCoins">0</span> Coins</span>
                <span class="text-gray-500 text-xs italic">Earn coins by staying online or daily login.</span>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const initialGames = [
            { title: "Buckshot Roulette", url: "https://bi6zone.vercel.app/g/buckshot-roulette.html" },
            { title: "Buckshot Roulette", url: "https://bi6zone.vercel.app/g/buckshot-roulette.html" },
            { title: "Buckshot Roulette", url: "https://bi6zone.vercel.app/g/buckshot-roulette.html" },
            { title: "1v1.lol", url: "https://bi6zone.vercel.app/g/1v1-lol.html" },
            { title: "Subway Surfers", url: "https://bi6zone.vercel.app/g/subwaysurfers/original.html" },
            { title: "Minecraft", url: "https://bi6zone.vercel.app/g/minecraft.html" },
            { title: "Block Blast", url: "https://bi6zone.vercel.app/g/block-blast.html" },
            { title: "Crossy Road", url: "https://bi6zone.vercel.app/g/crossy-road.html" },
            { title: "Monkey Mart", url: "https://bi6zone.vercel.app/g/monkeymart/index.html" },
            { title: "Lazy Jump 3D", url: "https://bi6zone.vercel.app/g/lazy-jump-3d.html" },
            { title: "Bubble Shooter", url: "https://bi6zone.vercel.app/g/bubble-shooter.html" },
            { title: "Stair Race 3D", url: "https://bi6zone.vercel.app/g/stair-race-3d.html" },
            { title: "Granny Offline", url: "https://bi6zone.vercel.app/g/granny-offline.html" },
            { title: "Granny 2", url: "https://bi6zone.vercel.app/g/granny-2.html" },
            { title: "Baldi's Plus", url: "https://bi6zone.vercel.app/g/baldis-plus.html" },
            { title: "Baldi's Remaster", url: "https://bi6zone.vercel.app/g/baldis-remaster.html" },
            { title: "Paper.io 2", url: "https://bi6zone.vercel.app/g/paper-io-2.html" },
            { title: "Basket Random", url: "https://bi6zone.vercel.app/g/basket-random.html" },
            { title: "Drift Boss", url: "https://bi6zone.vercel.app/g/drift-boss.html" },
            { title: "Drive Mad", url: "https://bi6zone.vercel.app/g/drive-mad.html" },
            { title: "Hole.io", url: "https://bi6zone.vercel.app/g/hole-io.html" },
            { title: "Geometry Dash", url: "https://bi6zone.vercel.app/g/geometry-dash.html" },
            { title: "Slither.io", url: "https://bi6zone.vercel.app/g/slither-io.html" },
            { title: "Snowball.io", url: "https://bi6zone.vercel.app/g/snowball-io.html" },
            { title: "Just Fall.io", url: "https://bi6zone.vercel.app/g/just-fall-io.html" },
            { title: "Ragdoll.io", url: "https://bi6zone.vercel.app/g/ragdoll-io.html" },
            { title: "Stickman Hook", url: "https://bi6zone.vercel.app/g/stickman-hook.html" },
            { title: "Flappy Bird", url: "https://bi6zone.vercel.app/g/flappy-bird.html" },
            { title: "Helix Jump", url: "https://bi6zone.vercel.app/g/helix-jump.html" },
            { title: "Moto X3M", url: "https://bi6zone.vercel.app/g/moto-x3m.html" },
            { title: "Rocket Soccer", url: "https://bi6zone.vercel.app/g/rocket-soccer.html" },
            { title: "OvO", url: "https://bi6zone.vercel.app/g/ovo.html" },
            { title: "OvO 2", url: "https://bi6zone.vercel.app/g/ovo-2.html" },
            { title: "OvO 3", url: "https://bi6zone.vercel.app/g/ovo-3.html" },
            { title: "Sky Race 3D", url: "https://bi6zone.vercel.app/g/clskyrace3d.html" },
            { title: "Slope", url: "https://bi6zone.vercel.app/g/slope.html" },
            { title: "Slope 2", url: "https://bi6zone.vercel.app/g/slope-2.html" },
            { title: "Poly Track", url: "https://vozharp719.wixsite.com/my-site-1/copy-of-ovo-11" },
            { title: "CS 1.6", url: "https://bi6zone.vercel.app/g/cs16.html" },
            { title: "Tiny Fishing", url: "https://bi6zone.vercel.app/g/tiny-fishing.html" },
            { title: "Eggy Car", url: "https://bi6zone.vercel.app/g/eggy-car.html" },
            
            // Newly Added Games
            { title: "Baseball GM", url: "https://zengm.com/baseball/" },
            { title: "Basketball GM", url: "https://play.basketball-gm.com/" },
            { title: "Football GM", url: "https://play.football-gm.com/" },
            { title: "Super Hot", url: "https://bi6zone.vercel.app/g/super-hot.html" },
            { title: "Cluster Rush", url: "https://bi6zone.vercel.app/g/cluster-rush.html" },
            { title: "TABS", url: "https://bi6zone.vercel.app/g/tabs.html" },
            { title: "Aquapark.io", url: "https://bi6zone.vercel.app/g/aquapark-io.html" },
            { title: "Cookie Clicker", url: "https://bi6zone.vercel.app/g/cookie-clicker.html" },
            { title: "Happy Wheels", url: "https://bi6zone.vercel.app/g/happy-wheels.html" },
            { title: "Infinite Craft", url: "https://bi6zone.vercel.app/g/infinite-craft.html" },
            { title: "Papa's Burgeria", url: "https://bi6zone.vercel.app/g/papas-burgeria.html" },
            { title: "Papa's Freezeria", url: "https://bi6zone.vercel.app/g/papas-freezeria.html" },
            { title: "Papa's Pizzeria", url: "https://bi6zone.vercel.app/g/papas-pizzeria.html" },
            { title: "BitLife", url: "https://bi6zone.vercel.app/g/bitlife.html" },
            { title: "Tetris", url: "https://bi6zone.vercel.app/g/tetris.html" },
            { title: "Chrome Dino", url: "https://bi6zone.vercel.app/g/chrome-dino.html" },
            { title: "WHG", url: "https://bi6zone.vercel.app/g/whg.html" },
            { title: "WHG 2", url: "https://bi6zone.vercel.app/g/whg2.html" },
            { title: "WHG 3", url: "https://bi6zone.vercel.app/g/whg3.html" },
            { title: "Uno", url: "https://bi6zone.vercel.app/g/uno.html" },
            { title: "Plinko Infinite", url: "https://bi6zone.vercel.app/g/plinkoinfinite.html" },
            { title: "Bloons TD", url: "https://bi6zone.vercel.app/g/btd.html" },
            { title: "Bloons TD 2", url: "https://bi6zone.vercel.app/g/btd2.html" },
            { title: "Bloons TD 3", url: "https://bi6zone.vercel.app/g/btd3.html" },
            { title: "Bloons TD 4", url: "https://bi6zone.vercel.app/g/bloonstd4.html" },
            { title: "Bloons TD 5", url: "https://bi6zone.vercel.app/g/bloonstd5.html" },
            { title: "Only Up", url: "https://bi6zone.vercel.app/g/only-up.html" },
            { title: "Repo", url: "https://bi6zone.vercel.app/g/repo.html" },
            { title: "Spacewaves", url: "https://bi6zone.vercel.app/g/spacewaves.html" },
            { title: "Gmod", url: "https://bi6zone.vercel.app/g/gmod.html" },
            { title: "Angry Birds", url: "https://bi6zone.vercel.app/g/angrybirds-chrome.html" },
            { title: "Steal A Brainrot", url: "https://bi6zone.vercel.app/g/steal-a-brainrot.html" },
            { title: "Fortzone", url: "https://bi6zone.vercel.app/g/fortzone.html" },
            { title: "Football Bros", url: "https://bi6zone.vercel.app/g/football-bros.html" },
            { title: "Kart Bros", url: "https://bi6zone.vercel.app/g/kart-bros.html" },
            { title: "Guess Their Answer", url: "https://bi6zone.vercel.app/g/guess-their-answer.html" },
            { title: "Bouncemasters", url: "https://bi6zone.vercel.app/g/bouncemasters.html" },
            { title: "State.io", url: "https://bi6zone.vercel.app/g/station/index.html" },
            { title: "Stack", url: "https://bi6zone.vercel.app/g/stack.html" },
            { title: "Burrito Bison", url: "https://bi6zone.vercel.app/g/burrito-bison-revenge.html" },
            { title: "Funny Battle Sim 2", url: "https://bi6zone.vercel.app/g/funny-battle-sim-2.html" },
            { title: "Slow Roads", url: "https://bi6zone.vercel.app/g/slowroads.html" },
            { title: "Real Flight Sim", url: "https://bi6zone.vercel.app/g/rfs.html" },
            { title: "Drift Hunters", url: "https://bi6zone.vercel.app/g/drift-hunters.html" },
            { title: "Ultimate Car Sim", url: "https://bi6zone.vercel.app/g/ucds.html" },
            { title: "Idle Miner Tycoon", url: "https://bi6zone.vercel.app/g/idle-miner-tycoon.html" },
            { title: "Idle Breakout", url: "https://idle-breakout.github.io/" },
            { title: "Retro Bowl", url: "https://bi6zone.vercel.app/g/retro-bowl.html" },
            { title: "Clash Royale", url: "https://bi6zone.vercel.app/g/clash-royal.html" },
            { title: "Gladihoppers", url: "https://bi6zone.vercel.app/g/gladihoppers.html" },
            { title: "Physics Game", url: "https://car563.github.io/" },
            { title: "Bowmasters", url: "https://bi6zone.vercel.app/g/bowmasters.html" },
            { title: "Raft", url: "https://bi6zone.vercel.app/g/raft.html" },
            { title: "Hollow Knight", url: "https://bi6zone.vercel.app/g/hollow-night.html" },
            { title: "Draw Climber", url: "https://bi6zone.vercel.app/g/draw-climber.html" },
            { title: "Stealth Master", url: "https://bi6zone.vercel.app/g/stealth-master.html" },
            { title: "Schoolboy Runaway", url: "https://bi6zone.vercel.app/g/schoolboy-runaway.html" },
            { title: "99 Nights in the Forest", url: "https://bi6zone.vercel.app/g/99nitf.html" },
            { title: "Grow A Garden", url: "https://bi6zone.vercel.app/g/grow-a-garden.html" },
            { title: "Redball 4", url: "https://bi6zone.vercel.app/g/redball-4.html" },
            { title: "Google Baseball", url: "https://bi6zone.vercel.app/g/google-baseball.html" },
            { title: "Knife Hit", url: "https://bi6zone.vercel.app/g/knife-hit.html" }
        ];

        // Popular games list for filtering
        const popularGames = ["Minecraft", "Subway Surfers", "Geometry Dash", "BitLife", "Football GM", "Slope", "Happy Wheels", "Bloons TD 5", "Cookie Clicker", "Among Us", "1v1.lol", "Retro Bowl", "Clash Royale"];

        let games = [];
        let favorites = [];
        let particlesEnabled = true;
        let is24Hour = false;
        let panicKey = 'Backquote'; // Default to ~
        let isBindingKey = false;
        let animationFrameId;
        let resizeListener; 
        let konamiCode = [];
        const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        let pendingApp = null; // Store app details for password check
        let splashEnabled = true;

        // Account Data
        let currentUser = null;
        const achievementsList = [
            { id: 'welcome', name: 'Welcome Aboard', icon: 'fa-door-open', desc: 'Sign up for an account' },
            { id: 'gamer', name: 'Gamer', icon: 'fa-gamepad', desc: 'Play your first game' },
            { id: 'scholar', name: 'Scholar', icon: 'fa-graduation-cap', desc: 'Use Wikipedia or Calculator' },
            { id: 'admin', name: 'Admin Access', icon: 'fa-user-shield', desc: 'Restricted.', rare: true }, 
            { id: 'nightowl', name: 'Night Owl', icon: 'fa-moon', desc: 'Log in after 8 PM' },
            { id: 'earlybird', name: 'Early Bird', icon: 'fa-sun', desc: 'Log in before 8 AM' },
            { id: 'artist', name: 'Artist', icon: 'fa-palette', desc: 'Change the theme color' },
            { id: 'spy', name: 'Secret Agent', icon: 'fa-user-secret', desc: 'Use the Panic Button' },
            { id: 'maestro', name: 'Maestro', icon: 'fa-music', desc: 'Open the Music Lab' },
            { id: 'marathon', name: 'Marathon Runner', icon: 'fa-running', desc: 'Spend 30 mins active on site', rare: true },
            { id: 'tycoon', name: 'Tycoon', icon: 'fa-gem', desc: 'Reach 500 Coins', rare: true },
            { id: 'boss', name: 'The Boss', icon: 'fa-trophy', desc: 'Reach Level 5', rare: true }
        ];
        
        // PFP Shop Data
        const pfpShop = [
            { id: 'default', icon: 'U', type: 'text', price: 0 },
            { id: 'ghost', icon: 'fa-ghost', type: 'icon', price: 100 },
            { id: 'robot', icon: 'fa-robot', type: 'icon', price: 150 },
            { id: 'ninja', icon: 'fa-user-ninja', type: 'icon', price: 200 },
            { id: 'astro', icon: 'fa-user-astronaut', type: 'icon', price: 250 },
            { id: 'skull', icon: 'fa-skull', type: 'icon', price: 300 },
            { id: 'dragon', icon: 'fa-dragon', type: 'icon', price: 500 },
            { id: 'crown', icon: 'fa-crown', type: 'icon', price: 1000 },
            // Unlockable PFPs
            { id: 'timekeeper', icon: 'fa-hourglass-end', type: 'icon', price: 'Achievement', achievementReq: 'marathon' },
            { id: 'rich', icon: 'fa-gem', type: 'icon', price: 'Achievement', achievementReq: 'tycoon' },
            { id: 'boss', icon: 'fa-trophy', type: 'icon', price: 'Achievement', achievementReq: 'boss' }
        ];

        // --- CORE FUNCTIONS ---

        function init() {
            // Load theme
            const theme = localStorage.getItem('gardenTheme');
            if(theme) setTheme(theme);

            // Load wallpaper
            const wallpaper = localStorage.getItem('gardenWallpaper');
            if(wallpaper) setWallpaper(wallpaper, false);

            // Load cursor
            const cursor = localStorage.getItem('gardenCursor');
            if(cursor) setCursor(cursor);

            // Load particles
            const particlesSetting = localStorage.getItem('gardenParticles');
            if (particlesSetting !== null) {
                particlesEnabled = particlesSetting === 'true';
                document.getElementById('particleToggle').checked = particlesEnabled;
            }
            if (particlesEnabled) initParticles();

            // Load Clock Setting
            is24Hour = localStorage.getItem('garden24Hour') === 'true';
            document.getElementById('clockToggle').checked = is24Hour;
            
            // Load Splash Setting
            const splashSetting = localStorage.getItem('gardenSplashEnabled');
            if (splashSetting !== null) {
                splashEnabled = splashSetting === 'true';
            }
            document.getElementById('splashToggle').checked = splashEnabled;

            // Load Panic Key
            const savedPanicKey = localStorage.getItem('gardenPanicKey');
            if(savedPanicKey) {
                panicKey = savedPanicKey;
                document.getElementById('currentPanicKey').innerText = formatKeyName(panicKey);
            }

            // Load Favorites
            favorites = JSON.parse(localStorage.getItem('gardenFavorites') || '[]');

            // Load games
            const saved = JSON.parse(localStorage.getItem('gardenGames') || '[]');
            const map = new Map();
            initialGames.forEach(g => map.set(g.url, g));
            saved.forEach(g => map.set(g.url, g));
            games = Array.from(map.values());

            // Load Notes
            const savedNotes = localStorage.getItem('gardenNotes');
            if(savedNotes) document.getElementById('notepadArea').value = savedNotes;

            // Load User
            const storedUser = localStorage.getItem('gardenUser');
            if(storedUser) {
                currentUser = JSON.parse(storedUser);
                // Ensure new fields exist for old users
                if(!currentUser.coins) currentUser.coins = 0;
                if(!currentUser.unlockedPfps) currentUser.unlockedPfps = ['default'];
                if(!currentUser.currentPfp) currentUser.currentPfp = 'default';
                if(!currentUser.totalMinutes) currentUser.totalMinutes = 0;
                
                checkDailyLogin();
                checkTimeAchievements();
            }

            // XP/Coin Timer & Time-based Achievements
            setInterval(() => {
                if(currentUser) {
                    addXP(10);
                    addCoins(1); // 1 coin per minute passive income
                    currentUser.totalMinutes = (currentUser.totalMinutes || 0) + 1;
                    
                    if(currentUser.totalMinutes >= 30) grantAchievement('marathon');
                    
                    // Periodic check for Night Owl / Early Bird
                    checkTimeAchievements();
                    
                    saveUser();
                }
            }, 60000); // 60 seconds

            renderGames();
            renderFavoritesSection();
            renderApps();
            setSplashText();
            initSplashEditor();
            initNotepad();
            initStatusIndicators();
            initAccountUI(); // Re-check UI for login state
            
            // Clock
            setInterval(updateClock, 1000);

            // Global Key Listener (Toggle + Konami)
            document.addEventListener('keydown', (e) => {
                if (isBindingKey) return; 
                
                // Panic
                if (e.code === panicKey) {
                    e.preventDefault();
                    const panicScreen = document.getElementById('panic-overlay');
                    panicScreen.classList.toggle('hidden');
                    grantAchievement('spy');
                }

                // Konami
                konamiCode.push(e.key);
                if (konamiCode.length > konamiSequence.length) {
                    konamiCode.shift();
                }
                if (JSON.stringify(konamiCode) === JSON.stringify(konamiSequence)) {
                    activateRainbowMode();
                }
            });
        }

        // --- PASSWORD SYSTEM ---
        function openPasswordModal(title, url) {
            pendingApp = { title, url };
            document.getElementById('passwordModal').classList.add('open');
            document.getElementById('passwordInput').value = "";
            document.getElementById('passwordError').classList.add('hidden');
            document.getElementById('passwordInput').focus();
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').classList.remove('open');
            pendingApp = null;
        }

        function checkPassword() {
            const pass = document.getElementById('passwordInput').value;
            if (pass === "724five") {
                if (pendingApp) {
                    launchGame(pendingApp.title, pendingApp.url);
                }
                closePasswordModal();
            } else {
                document.getElementById('passwordError').classList.remove('hidden');
                document.getElementById('passwordInput').value = "";
                document.getElementById('passwordInput').focus();
            }
        }
        
        // Allow Enter key in password modal
        document.getElementById('passwordInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') checkPassword();
        });

        // --- ACCOUNT & XP SYSTEM ---
        
        function handleLogin() {
            const name = document.getElementById('loginName').value.trim();
            const email = document.getElementById('loginEmail').value.trim();
            const errorMsg = document.getElementById('loginError');

            if (!email.endsWith('@student.elanco.org')) {
                errorMsg.classList.remove('hidden');
                return;
            }

            // Create User
            currentUser = {
                name: name,
                email: email,
                level: 1,
                xp: 0,
                coins: 50, // Sign up bonus
                achievements: ['welcome'],
                lastLoginDate: new Date().toDateString(),
                unlockedPfps: ['default'],
                currentPfp: 'default',
                totalMinutes: 0
            };

            // Check for Admin Achievement
            const lowerName = name.toLowerCase();
            if (lowerName === 'pavlo' || lowerName === 'alex' || lowerName === 'jackson') {
                currentUser.achievements.push('admin');
            }

            saveUser();
            initAccountUI();
            checkTimeAchievements();
            // Just signed up so disable daily for today
            const btn = document.getElementById('dailyRewardBtn');
            if(btn) {
                btn.disabled = true;
                btn.innerText = "Claimed for Today";
                btn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        function handleLogout() {
            localStorage.removeItem('gardenUser');
            currentUser = null;
            location.reload();
        }

        function saveUser() {
            localStorage.setItem('gardenUser', JSON.stringify(currentUser));
        }

        function addXP(amount) {
            if (!currentUser) return;
            currentUser.xp += amount;
            const nextLevel = Math.floor(currentUser.xp / 100) + 1;
            if (nextLevel > currentUser.level) {
                currentUser.level = nextLevel;
                if(currentUser.level >= 5) grantAchievement('boss');
            }
            saveUser();
            if(document.getElementById('section-account').classList.contains('active')) updateProfileStats();
        }

        function addCoins(amount) {
             if (!currentUser) return;
             currentUser.coins += amount;
             if(currentUser.coins >= 500) grantAchievement('tycoon');
             saveUser();
             if(document.getElementById('section-account').classList.contains('active')) updateProfileStats();
        }

        function grantAchievement(id) {
            if (!currentUser || currentUser.achievements.includes(id)) return;
            currentUser.achievements.push(id);
            
            // Check rewards
            if(id === 'marathon') unlockPfp('timekeeper');
            if(id === 'tycoon') unlockPfp('rich');
            if(id === 'boss') unlockPfp('boss');

            saveUser();
            if(document.getElementById('section-account').classList.contains('active')) {
                renderAchievements();
                renderShop();
            }
        }
        
        function unlockPfp(pfpId) {
            if(!currentUser.unlockedPfps.includes(pfpId)) {
                currentUser.unlockedPfps.push(pfpId);
            }
        }

        function checkTimeAchievements() {
            if (!currentUser) return;
            const hour = new Date().getHours();
            if (hour >= 20 || hour < 4) grantAchievement('nightowl');
            if (hour >= 4 && hour < 8) grantAchievement('earlybird');
        }

        function checkDailyLogin() {
            if(!currentUser) return;
            const today = new Date().toDateString();
            const btn = document.getElementById('dailyRewardBtn');
            // Safe check for button existence (fixes potential bug)
            if(!btn) return;
            
            if (currentUser.lastLoginDate !== today) {
                btn.disabled = false;
                btn.innerText = "Claim Daily Reward (50 Coins)";
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                btn.disabled = true;
                btn.innerText = "Claimed for Today";
                btn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        function claimDailyReward() {
            if(!currentUser) return;
            addCoins(50);
            currentUser.lastLoginDate = new Date().toDateString();
            saveUser();
            checkDailyLogin();
        }

        // --- SHOP SYSTEM ---
        function openShop() {
            document.getElementById('shopModal').classList.add('open');
            renderShop();
            const coinDisplay = document.getElementById('shopCoins');
            if(coinDisplay) coinDisplay.innerText = currentUser.coins;
        }

        function closeShop() {
            document.getElementById('shopModal').classList.remove('open');
        }

        function buyPfp(id, price) {
            if(currentUser.coins >= price) {
                currentUser.coins -= price;
                currentUser.unlockedPfps.push(id);
                saveUser();
                renderShop(); // Refresh UI
                updateProfileStats();
                const coinDisplay = document.getElementById('shopCoins');
                if(coinDisplay) coinDisplay.innerText = currentUser.coins;
            } else {
                alert("Not enough coins!");
            }
        }

        function equipPfp(id) {
            currentUser.currentPfp = id;
            saveUser();
            renderShop();
            renderProfileAvatar();
        }

        function renderShop() {
            const grid = document.getElementById('shopGrid');
            if (!grid) return; 
            grid.innerHTML = "";

            pfpShop.forEach(item => {
                const isOwned = currentUser.unlockedPfps.includes(item.id);
                const isEquipped = currentUser.currentPfp === item.id;
                
                const card = document.createElement('div');
                card.className = `bg-black/40 p-3 rounded-lg border flex flex-col items-center gap-2 relative ${isEquipped ? 'border-yellow-400' : 'border-white/10'}`;
                
                // Item Icon
                let iconHtml = '';
                if (item.type === 'text') {
                    iconHtml = `<span class="text-2xl font-bold text-white">${currentUser.name.charAt(0).toUpperCase()}</span>`;
                } else {
                    iconHtml = `<i class="fas ${item.icon} text-2xl text-white"></i>`;
                }

                let actionBtn = '';
                if (isEquipped) {
                    actionBtn = `<button class="text-xs bg-yellow-600 text-white w-full py-1 rounded cursor-default">Equipped</button>`;
                } else if (isOwned) {
                    actionBtn = `<button onclick="equipPfp('${item.id}')" class="text-xs bg-blue-600 hover:bg-blue-500 text-white w-full py-1 rounded">Equip</button>`;
                } else {
                    if (item.price === 'Achievement') {
                        const achName = achievementsList.find(a => a.id === item.achievementReq)?.name || "Achievement";
                        actionBtn = `<button class="text-[10px] bg-gray-700 text-gray-400 w-full py-1 rounded cursor-not-allowed">Unlock: ${achName}</button>`;
                    } else {
                        actionBtn = `<button onclick="buyPfp('${item.id}', ${item.price})" class="text-xs bg-green-700 hover:bg-green-600 text-white w-full py-1 rounded">${item.price} <i class="fas fa-coins text-[10px]"></i></button>`;
                    }
                }

                card.innerHTML = `
                    <div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center border border-white/20 mb-1">
                        ${iconHtml}
                    </div>
                    ${actionBtn}
                `;
                grid.appendChild(card);
            });
        }

        function renderProfileAvatar() {
            const avatarEl = document.getElementById('profileAvatar');
            if(!currentUser || !avatarEl) return;
            
            const pfpId = currentUser.currentPfp || 'default';
            const pfpData = pfpShop.find(p => p.id === pfpId) || pfpShop[0];
            
            avatarEl.innerHTML = ""; // Clear old
            
            if (pfpData.type === 'text') {
                avatarEl.innerText = currentUser.name.charAt(0).toUpperCase();
            } else {
                avatarEl.innerHTML = `<i class="fas ${pfpData.icon}"></i>`;
            }
        }

        function initAccountUI() {
            const loginForm = document.getElementById('login-form');
            const profileView = document.getElementById('profile-view');

            // Safety check
            if (!loginForm || !profileView) return; 

            if (currentUser) {
                loginForm.classList.add('hidden');
                profileView.classList.remove('hidden');
                profileView.classList.add('flex');
                
                document.getElementById('profileName').innerText = currentUser.name;
                document.getElementById('profileEmail').innerText = currentUser.email;
                
                renderProfileAvatar(); // Set correct PFP
                updateProfileStats();
                renderCalendar();
                renderAchievements();
                checkDailyLogin();

            } else {
                loginForm.classList.remove('hidden');
                profileView.classList.add('hidden');
                profileView.classList.remove('flex');
            }
        }

        function updateProfileStats() {
            if(!currentUser) return;
            const lvl = document.getElementById('profileLevel');
            const xp = document.getElementById('profileXP');
            const coins = document.getElementById('profileCoins');
            const bar = document.getElementById('xpBar');
            
            if(lvl) lvl.innerText = `Lvl ${currentUser.level}`;
            if(xp) xp.innerText = `${currentUser.xp} XP`;
            if(coins) coins.innerText = currentUser.coins;
            
            if(bar) {
                const progress = currentUser.xp % 100;
                bar.style.width = `${progress}%`;
            }
        }

        function renderAchievements() {
            const grid = document.getElementById('achievementsGrid');
            if (!grid) return; // Fix
            grid.innerHTML = "";
            
            achievementsList.forEach(ach => {
                const unlocked = currentUser.achievements.includes(ach.id);
                const colorClass = unlocked ? (ach.rare ? 'text-yellow-400 border-yellow-400/50 bg-yellow-400/10' : 'text-blue-400 border-blue-400/50 bg-blue-400/10') : 'text-gray-600 border-gray-700 bg-black/20';
                const opacity = unlocked ? 'opacity-100' : 'opacity-50';
                
                const div = document.createElement('div');
                div.className = `p-3 rounded-lg border flex flex-col items-center text-center gap-2 ${colorClass} ${opacity}`;
                div.innerHTML = `
                    <i class="fas ${ach.icon} text-2xl"></i>
                    <div>
                        <div class="font-bold text-xs">${ach.name}</div>
                        <div class="text-[10px] opacity-70">${ach.desc}</div>
                    </div>
                `;
                grid.appendChild(div);
            });
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthLabel = document.getElementById('calendarMonth');
            if (!grid || !monthLabel) return; // Fix
            
            grid.innerHTML = "";
            
            const date = new Date();
            const month = date.toLocaleString('default', { month: 'long' });
            const year = date.getFullYear();
            const today = date.getDate();
            
            monthLabel.innerText = `${month} ${year}`;
            
            // Simple calendar logic
            const daysInMonth = new Date(year, date.getMonth() + 1, 0).getDate();
            const firstDay = new Date(year, date.getMonth(), 1).getDay(); // 0 = Sun
            
            // Empty slots
            for(let i=0; i<firstDay; i++) {
                grid.appendChild(document.createElement('div'));
            }
            
            // Days
            for(let i=1; i<=daysInMonth; i++) {
                const d = document.createElement('div');
                d.className = `calendar-day ${i === today ? 'calendar-today' : ''}`;
                d.innerText = i;
                grid.appendChild(d);
            }
        }

        // Hook navigation to check account status
        const originalNavTo = navTo;
        // Modified navTo is below in NAVIGATION section

        // --- STATUS INDICATORS ---
        function initStatusIndicators() {
            const batteryEl = document.getElementById('battery-level');
            const wifiEl = document.getElementById('wifi-icon');

            // Wifi
            function updateWifi() {
                wifiEl.innerHTML = navigator.onLine ? '<i class="fas fa-wifi"></i>' : '<i class="fas fa-wifi-slash text-red-500"></i>';
            }
            window.addEventListener('online', updateWifi);
            window.addEventListener('offline', updateWifi);
            updateWifi();

            // Battery (Chrome only mostly)
            if ('getBattery' in navigator) {
                navigator.getBattery().then(battery => {
                    batteryEl.classList.remove('hidden');
                    function updateBattery() {
                        const level = Math.round(battery.level * 100);
                        const icon = level > 75 ? 'fa-battery-full' : level > 50 ? 'fa-battery-three-quarters' : level > 25 ? 'fa-battery-half' : 'fa-battery-quarter';
                        batteryEl.innerHTML = `<i class="fas ${icon}"></i> <span>${level}%</span>`;
                    }
                    updateBattery();
                    battery.addEventListener('levelchange', updateBattery);
                });
            }
        }

        function updateClock() {
            const d = new Date();
            const options = { hour: '2-digit', minute: '2-digit', hour12: !is24Hour };
            const timeStr = d.toLocaleTimeString([], options);
            document.getElementById('clock').innerText = timeStr;
        }

        // --- TAB CLOAKING ---
        function cloakTab(service) {
            let title = "GARDENSPOT";
            let icon = "favicon.ico";

            if (service === 'drive') {
                title = "My Drive - Google Drive";
                icon = "https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png";
            } else if (service === 'classroom') {
                title = "Classes";
                icon = "https://ssl.gstatic.com/classroom/favicon.png";
            } else if (service === 'canvas') {
                title = "Dashboard";
                icon = "https://du11hjcvx0uqb.cloudfront.net/dist/images/favicon-e10d657a73.ico";
            } else if (service === 'zoom') {
                title = "Zoom Meeting";
                icon = "https://st1.zoom.us/zoom.ico";
            }

            document.title = title;
            let link = document.querySelector("link[rel*='icon']") || document.createElement('link');
            link.type = 'image/x-icon';
            link.rel = 'shortcut icon';
            link.href = icon;
            document.head.appendChild(link);
        }

        // --- FULLSCREEN TOGGLE ---
        function toggleGlobalFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(e => console.log(e));
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        // --- ABOUT:BLANK LAUNCHER ---
        function launchGlobalBlanker() {
            const win = window.open('about:blank', '_blank');
            if (!win) {
                alert("Popup blocked! Please allow popups.");
                return;
            }
            const doc = win.document;
            const url = window.location.href;
            
            doc.open();
            doc.write(`
                <!DOCTYPE html>
                <html style="margin:0; padding:0; overflow:hidden; height:100%;">
                <head>
                    <title>Google Drive</title>
                    <link rel="icon" href="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png">
                </head>
                <body style="margin:0; padding:0; overflow:hidden; height:100%;">
                    <iframe src="${url}" style="width:100%; height:100%; border:none; display:block;"></iframe>
                </body>
                </html>
            `);
            doc.close();
        }

        // --- CUSTOM CURSOR ---
        function setCursor(cursorClass) {
            document.body.className = document.body.className.replace(/cursor-\w+/g, "").trim();
            if(cursorClass) document.body.classList.add(cursorClass);
            localStorage.setItem('gardenCursor', cursorClass);
        }

        // --- KONAMI CODE ---
        function activateRainbowMode() {
            document.body.classList.add('rainbow-mode');
            alert("ðŸŒˆ KONAMI CODE ACTIVATED! ðŸŒˆ");
        }

        // --- NOTEPAD ---
        function initNotepad() {
            const textarea = document.getElementById('notepadArea');
            const status = document.getElementById('saveStatus');
            
            textarea.addEventListener('input', () => {
                localStorage.setItem('gardenNotes', textarea.value);
                status.innerText = "Saved";
                setTimeout(() => status.innerText = "", 1000);
            });
        }

        // --- SYSTEM SPECS ---
        function loadSystemSpecs() {
            const grid = document.getElementById('specsGrid');
            grid.innerHTML = "";
            
            const specs = [
                { label: "OS / Platform", value: navigator.platform },
                { label: "Browser Engine", value: navigator.userAgent.split(') ')[0] + ')' },
                { label: "Screen Resolution", value: `${window.screen.width} x ${window.screen.height}` },
                { label: "Window Size", value: `${window.innerWidth} x ${window.innerHeight}` },
                { label: "Cores (Threads)", value: navigator.hardwareConcurrency || "Unknown" },
                { label: "Memory (RAM)", value: navigator.deviceMemory ? `~${navigator.deviceMemory} GB` : "Unknown" },
                { label: "Language", value: navigator.language },
                { label: "Online Status", value: navigator.onLine ? "Online" : "Offline" },
                { label: "Touch Support", value: 'ontouchstart' in window ? "Yes" : "No" },
                { label: "Timezone", value: Intl.DateTimeFormat().resolvedOptions().timeZone }
            ];

            specs.forEach(s => {
                const item = document.createElement('div');
                item.className = "bg-black/30 p-3 rounded border border-white/5 flex flex-col";
                item.innerHTML = `
                    <span class="text-gray-400 text-xs uppercase tracking-wider mb-1">${s.label}</span>
                    <span class="text-white font-bold truncate" title="${s.value}">${s.value}</span>
                `;
                grid.appendChild(item);
            });
        }

        // --- WALLPAPER ---
        function saveWallpaper() {
            const url = document.getElementById('wallpaperInput').value.trim();
            if(url) {
                setWallpaper(url, true);
                document.getElementById('wallpaperInput').value = "";
            }
        }

        function setWallpaper(url, save) {
            const bgDiv = document.getElementById('custom-bg');
            bgDiv.style.backgroundImage = `url('${url}')`;
            bgDiv.style.opacity = 1;
            
            // Hide waves/particles for clearer view
            document.querySelector('.wave-container').style.opacity = 0;
            document.getElementById('particle-canvas').style.opacity = 0;

            if(save) localStorage.setItem('gardenWallpaper', url);
        }

        function clearWallpaper() {
            const bgDiv = document.getElementById('custom-bg');
            bgDiv.style.opacity = 0;
            setTimeout(() => bgDiv.style.backgroundImage = 'none', 500);

            document.querySelector('.wave-container').style.opacity = 1;
            document.getElementById('particle-canvas').style.opacity = 1;
            
            localStorage.removeItem('gardenWallpaper');
        }

        // --- SPLASH TEXT TOGGLE ---
        function toggleSplashText() {
            const checkbox = document.getElementById('splashToggle');
            splashEnabled = checkbox.checked;
            localStorage.setItem('gardenSplashEnabled', splashEnabled);
            setSplashText(); // Update immediate visibility
        }

        // --- SPLASH TEXT ---
        function setSplashText() {
            const splashEl = document.getElementById('splash-text');
            
            if (!splashEnabled) {
                splashEl.style.display = 'none';
                return;
            } else {
                splashEl.style.display = 'block';
            }

            const customSplash = localStorage.getItem('gardenCustomSplash');
            if (customSplash) {
                splashEl.innerText = customSplash;
                return;
            }

            const msgs = [
                "New Website", "https://gardenspot.vercel.app/", "Thanks for checking it out!", "What should I add?", "Old one got blocked :(", "Add me on Snapchat: pavlo.v"
            ];
            const r = Math.floor(Math.random() * msgs.length);
            splashEl.innerText = msgs[r];
        }

        // --- SPLASH TEXT EDITOR ---
        function initSplashEditor() {
            const splashLabel = document.getElementById('splash-text');
            splashLabel.title = "Double-click to edit";
            splashLabel.style.cursor = "pointer";

            splashLabel.addEventListener('dblclick', () => {
                if(!splashEnabled) return; // Don't edit if hidden

                const current = splashLabel.innerText;
                const input = document.createElement('input');
                input.value = current;
                input.maxLength = 30; // Char limit
                // Match styles to blend in
                input.className = "bg-black/50 text-white font-mono text-xs md:text-sm text-center outline-none border border-blue-500 rounded px-2 py-1 w-64";
                
                splashLabel.innerHTML = "";
                splashLabel.appendChild(input);
                input.focus();
                
                function save() {
                    const val = input.value.trim();
                    if (val) {
                        localStorage.setItem('gardenCustomSplash', val);
                        splashLabel.innerText = val;
                    } else {
                        localStorage.removeItem('gardenCustomSplash');
                        setSplashText(); // Restore random
                    }
                }

                input.addEventListener('blur', save);
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') input.blur();
                });
            });
        }

        // --- APPS RENDERER ---
        function renderApps() {
            const grid = document.getElementById('appsGrid');
            if(!grid) return;
            grid.innerHTML = "";
            
            const appList = [
                { title: "Request Games", url: "https://docs.google.com/forms/d/e/1FAIpQLSezQeL4t8QbDpy3DIlOXx6RCabLFa4r0NeIS5b34A629B1wkQ/viewform?embedded=true", icon: "fa-paper-plane" },
                { title: "Notepad", url: "notepad", icon: "fa-sticky-note" },
                { title: "System Specs", url: "specs", icon: "fa-microchip" },
                { title: "AI Chat", url: "https://www.chattide.ai/chat-gpt/", icon: "fa-robot" },
                { title: "Calculator", url: "https://www.desmos.com/scientific", icon: "fa-calculator" },
                { title: "Lines", url: "https://lines.chromeexperiments.com/", icon: "fa-bezier-curve" },
                { title: "Maps", url: "https://www.openstreetmap.org/export/embed.html", icon: "fa-map-marked-alt" },
                { title: "Space", url: "https://mrdoob.com/projects/chromeexperiments/google-space/", icon: "fa-rocket" },
                { title: "Paint", url: "https://jspaint.app/", icon: "fa-palette" },
                { title: "Music Lab", url: "https://musiclab.chromeexperiments.com/Song-Maker/", icon: "fa-music" },
                { title: "Windows Emulator", url: "https://t9os.vercel.app/class.html", icon: "fa-window-maximize" },
                { title: "Wikipedia", url: "https://en.m.wikipedia.org/", icon: "fa-book" },
                { title: "Global Weather", url: "https://embed.windy.com/embed2.html", icon: "fa-cloud-sun" },
                { title: "Etch-a-sketch", url: "https://bi6zone.vercel.app/a/etchasketch/index.html", icon: "fa-brush" },
                { title: "Godo Blocks", url: "https://bi6zone.vercel.app/a/godoblocks/index.html", icon: "fa-cube" },
                { title: "WebGL Fluids", url: "https://bi6zone.vercel.app/a/fluidsim/index.html", icon: "fa-water" },
                { title: "Blooket", url: "https://www.blooket.com/", icon: "fa-b" }
            ];

            appList.forEach(app => {
                const el = document.createElement('div');
                el.className = 'game-card h-40 group flex flex-col items-center justify-center gap-4 bg-gray-900 hover:bg-gray-800 transition cursor-pointer';
                
                if (app.url === "notepad") {
                    el.onclick = () => navTo('notepad');
                } else if (app.url === "specs") {
                    el.onclick = () => {
                        loadSystemSpecs();
                        navTo('specs');
                    };
                } else if (app.title === "Windows Emulator") {
                    el.onclick = () => openPasswordModal(app.title, app.url);
                } else {
                    el.onclick = () => launchGame(app.title, app.url);
                }
                
                // Removed 'brand-font' class from the span below
                el.innerHTML = `
                    <i class="fas ${app.icon} text-4xl text-gray-400 group-hover:text-white transition" style="text-shadow: 0 0 10px var(--neon-color)"></i>
                    <span class="text-xl font-bold text-gray-300 group-hover:text-white tracking-wide">${app.title}</span>
                `;
                grid.appendChild(el);
            });
        }

        // --- SETTINGS LOGIC ---
        function toggleClockFormat() {
            is24Hour = document.getElementById('clockToggle').checked;
            localStorage.setItem('garden24Hour', is24Hour);
            // Force immediate update
            const d = new Date();
            const options = { hour: '2-digit', minute: '2-digit', hour12: !is24Hour };
            document.getElementById('clock').innerText = d.toLocaleTimeString([], options);
        }

        function startKeyBinding() {
            const btn = document.getElementById('bindKeyBtn');
            const display = document.getElementById('currentPanicKey');
            
            isBindingKey = true;
            btn.innerText = "PRESS ANY KEY...";
            btn.classList.add('bg-blue-600', 'text-white');
            
            const bindListener = (e) => {
                e.preventDefault();
                panicKey = e.code;
                localStorage.setItem('gardenPanicKey', panicKey);
                
                display.innerText = formatKeyName(panicKey);
                btn.innerText = "CHANGE KEY";
                btn.classList.remove('bg-blue-600', 'text-white');
                
                isBindingKey = false;
                document.removeEventListener('keydown', bindListener);
            };
            
            document.addEventListener('keydown', bindListener);
        }

        function formatKeyName(code) {
            if (code === 'Backquote') return '~';
            if (code.startsWith('Key')) return code.replace('Key', '');
            if (code.startsWith('Digit')) return code.replace('Digit', '');
            return code;
        }

        // --- FILTER & SORT LOGIC ---
        function getSortedGames() {
            const filter = document.getElementById('gameFilter').value;
            const search = document.getElementById('searchInput').value.toLowerCase();
            
            // 1. Filter by Search
            let filtered = games.filter(g => g.title.toLowerCase().includes(search));

            // 2. Sort Logic
            if (filter === 'az') {
                filtered.sort((a, b) => a.title.localeCompare(b.title));
            } else if (filter === 'za') {
                filtered.sort((a, b) => b.title.localeCompare(a.title));
            } else if (filter === 'newest') {
                filtered.reverse(); // Assuming array order is oldest -> newest
            } else if (filter === 'oldest') {
                // Default order
            } else if (filter === 'popular') {
                filtered.sort((a, b) => {
                    const isAPop = popularGames.includes(a.title);
                    const isBPop = popularGames.includes(b.title);
                    return (isAPop === isBPop) ? 0 : isAPop ? -1 : 1;
                });
            }

            return filtered;
        }

        // --- RENDERERS ---
        function renderGames() {
            const grid = document.getElementById('gameGrid');
            grid.innerHTML = "";
            const list = getSortedGames();
            
            list.forEach(g => {
                const el = document.createElement('div');
                el.className = 'game-card h-40 group';
                
                // Click handler wrapper to ignore clicks on heart
                el.onclick = (e) => {
                    if (!e.target.closest('.fav-btn')) launchGame(g.title, g.url);
                };
                
                const bgColors = ['#1a202c', '#2d3748', '#4a5568', '#1c4532', '#1e3a8a'];
                const bg = bgColors[Math.floor(Math.random() * bgColors.length)];
                
                const isFav = favorites.includes(g.title);
                const heartClass = isFav ? 'active' : '';

                el.innerHTML = `
                    <div class="fav-btn ${heartClass}" data-title="${g.title}" onclick="toggleFavorite(this.dataset.title)">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="h-28 w-full flex items-center justify-center relative" style="background:${bg}">
                        <span class="text-3xl font-bold text-white/20 select-none">${g.title.substring(0,2).toUpperCase()}</span>
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition"></div>
                    </div>
                    <div class="p-3 bg-gray-900 h-12 flex items-center">
                        <h3 class="text-gray-200 text-sm font-bold truncate w-full group-hover:text-white transition">${g.title}</h3>
                    </div>
                `;
                grid.appendChild(el);
            });
        }

        function renderFavoritesSection() {
            const section = document.getElementById('favoritesSection');
            const grid = document.getElementById('favoritesGrid');
            
            if (favorites.length === 0) {
                section.classList.add('hidden');
                return;
            }
            
            section.classList.remove('hidden');
            grid.innerHTML = "";
            
            favorites.forEach(title => {
                const g = games.find(game => game.title === title);
                if(!g) return;

                const el = document.createElement('div');
                el.className = 'game-card w-40 flex-shrink-0 group relative cursor-pointer h-32';
                el.onclick = () => launchGame(g.title, g.url);
                
                const bg = '#111827'; 

                el.innerHTML = `
                    <div class="h-20 w-full flex items-center justify-center relative" style="background:${bg}">
                        <span class="text-2xl font-bold text-white/20 select-none">${g.title.substring(0,2).toUpperCase()}</span>
                    </div>
                    <div class="p-2 bg-gray-900 h-12 flex items-center">
                        <h3 class="text-gray-200 text-xs font-bold truncate w-full">${g.title}</h3>
                    </div>
                `;
                grid.appendChild(el);
            });
        }

        // --- FEATURES ---
        function toggleFavorite(title) {
            const idx = favorites.indexOf(title);
            if (idx > -1) favorites.splice(idx, 1);
            else favorites.push(title);
            
            localStorage.setItem('gardenFavorites', JSON.stringify(favorites));
            renderGames();
            renderFavoritesSection();
        }

        // --- PARTICLES ENGINE ---
        function initParticles() {
            const canvas = document.getElementById('particle-canvas');
            const ctx = canvas.getContext('2d');
            let particles = [];
            
            // Mouse tracking for visualizer
            let mouseSpeed = 0;
            let lastMouseX = 0;
            let lastMouseY = 0;
            
            document.addEventListener('mousemove', (e) => {
                const dx = e.clientX - lastMouseX;
                const dy = e.clientY - lastMouseY;
                const dist = Math.sqrt(dx*dx + dy*dy);
                
                mouseSpeed = dist * 0.05; // Sensitivity
                if (mouseSpeed > 8) mouseSpeed = 8; // Cap speed
                
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
            });

            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            // Fix: remove previous listener to prevent leaks if called multiple times
            if(resizeListener) window.removeEventListener('resize', resizeListener);
            resizeListener = resize;
            window.addEventListener('resize', resize);
            resize();

            class Particle {
                constructor() {
                    this.x = Math.random() * canvas.width;
                    // Spawn primarily in the bottom 70% of the screen
                    this.y = canvas.height - (Math.random() * canvas.height * 0.7);
                    this.size = Math.random() * 2 + 0.5;
                    this.baseSpeedX = Math.random() * 0.5 - 0.25;
                    // Bias slightly upwards
                    this.baseSpeedY = (Math.random() * 0.5 - 0.35); 
                    this.opacity = Math.random() * 0.5 + 0.2;
                }
                update() {
                    // React to mouse speed
                    let speedMult = 1 + mouseSpeed;
                    
                    this.x += this.baseSpeedX * speedMult;
                    this.y += this.baseSpeedY * speedMult;
                    
                    // Boundary wrap
                    if (this.x > canvas.width) this.x = 0;
                    if (this.x < 0) this.x = canvas.width;
                    
                    // Vertical Boundary Logic (Bottom weighted)
                    
                    // If it goes off the top, reset to bottom
                    if (this.y < 0) {
                        this.y = canvas.height;
                        this.x = Math.random() * canvas.width;
                    }

                    // If it goes off the bottom, wrap to "top" of bottom area (70% down) or just reset
                     if (this.y > canvas.height) {
                         this.y = canvas.height - (Math.random() * canvas.height * 0.2); // near bottom
                     }
                    
                    // If particle drifts too high (above top 20%), reset to bottom to keep visual weight down
                    if (this.y < canvas.height * 0.2) {
                         this.y = canvas.height;
                         this.x = Math.random() * canvas.width;
                    }
                    
                    // Decay mouse speed effect
                    if (mouseSpeed > 0) mouseSpeed *= 0.95;
                }
                draw() {
                    ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            for (let i = 0; i < 80; i++) particles.push(new Particle());

            function animate() {
                if (!particlesEnabled) {
                    ctx.clearRect(0,0, canvas.width, canvas.height);
                    return; 
                }
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                for (let i = 0; i < particles.length; i++) {
                    particles[i].update();
                    particles[i].draw();
                }
                animationFrameId = requestAnimationFrame(animate);
            }
            animate();
        }

        function toggleParticles() {
            const checkbox = document.getElementById('particleToggle');
            particlesEnabled = checkbox.checked;
            localStorage.setItem('gardenParticles', particlesEnabled);
            
            if(particlesEnabled) {
                initParticles();
            } else {
                cancelAnimationFrame(animationFrameId);
                const canvas = document.getElementById('particle-canvas');
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0,0, canvas.width, canvas.height);
            }
        }

        // --- NAVIGATION ---

        function navTo(id) {
            // Check account requirement before entering sections
            if(id === 'account') {
                initAccountUI();
            }
            
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(`section-${id}`).classList.add('active');
        }

        function goHome() {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('section-home').classList.add('active');
        }

        // --- PLAYER ---

        function launchGame(title, url) {
            // Tutorial check
            if (!localStorage.getItem('gardenTutorialShown')) {
                document.getElementById('player-tutorial').classList.remove('hidden');
            }
            
            // Add XP removed here (now time based)
            grantAchievement('gamer');
            if (title === "Calculator" || title === "Wikipedia") grantAchievement('scholar');
            if (title === "Music Lab") grantAchievement('maestro');
            if (title === "Global Weather") grantAchievement('meteorologist');

            const player = document.getElementById('section-player');
            const frame = document.getElementById('gameFrame');
            const label = document.getElementById('playerTitle');
            
            label.innerText = title;
            player.style.display = 'flex';
            frame.src = url;
        }

        function closeGame() {
            const player = document.getElementById('section-player');
            const frame = document.getElementById('gameFrame');
            
            if(document.fullscreenElement) {
                document.exitFullscreen().catch(err => console.log(err));
            }

            frame.src = 'about:blank';
            player.style.display = 'none';
        }

        function toggleFullscreen() {
            const playerSection = document.getElementById('section-player');
            if (!document.fullscreenElement) playerSection.requestFullscreen();
            else document.exitFullscreen();
        }

        function openInBlank() {
            const frame = document.getElementById('gameFrame');
            const url = frame.src;
            if (!url || url === 'about:blank') return;
            openUrlInBlank(url);
        }

        function openUrlInBlank(url) {
            const win = window.open('about:blank', '_blank');
            if (!win) {
                alert("Popup blocked! Please allow popups for GardenSpot.");
                return;
            }

            const doc = win.document;
            doc.open();
            doc.write(`
                <!DOCTYPE html>
                <html style="margin:0; padding:0; overflow:hidden; height:100%;">
                <head>
                    <title>My Drive - Google Drive</title>
                    <link rel="icon" href="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png">
                </head>
                <body style="margin:0; padding:0; overflow:hidden; height:100%;">
                    <iframe src="${url}" style="width:100%; height:100%; border:none; display:block;"></iframe>
                </body>
                </html>
            `);
            doc.close();
        }

        function closeTutorial() {
            document.getElementById('player-tutorial').classList.add('hidden');
            localStorage.setItem('gardenTutorialShown', 'true');
        }

        // --- UNBLOCKER ---
        function launchProxy() {
            const urlInput = document.getElementById('proxyUrl');
            let url = urlInput.value.trim();
            if(!url) return;

            if (!url.startsWith('http')) {
                url = 'https://' + url;
            }

            // Direct load attempt
            launchGame('Browser', url);
        }

        function launchCloakedProxy() {
            const urlInput = document.getElementById('proxyUrl');
            let url = urlInput.value.trim();
            if(!url) return;

            if (!url.startsWith('http')) {
                url = 'https://' + url;
            }

            const win = window.open('about:blank', '_blank');
            if (!win) {
                alert("Popup blocked! Please allow popups for GardenSpot.");
                return;
            }

            const doc = win.document;
            doc.open();
            doc.write(`
                <!DOCTYPE html>
                <html style="margin:0; padding:0; overflow:hidden; height:100%;">
                <head>
                    <title>My Drive - Google Drive</title>
                    <link rel="icon" href="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png">
                </head>
                <body style="margin:0; padding:0; overflow:hidden; height:100%;">
                    <iframe src="${url}" style="width:100%; height:100%; border:none; display:block;"></iframe>
                </body>
                </html>
            `);
            doc.close();
        }

        // --- SETTINGS ---
        function setTheme(color) {
            let r=0, g=0, b=0;
            if(color.length === 7) {
                r = parseInt(color.slice(1,3), 16);
                g = parseInt(color.slice(3,5), 16);
                b = parseInt(color.slice(5,7), 16);
            }
            
            document.documentElement.style.setProperty('--neon-color', color);
            document.documentElement.style.setProperty('--bg-glow', `rgba(${r}, ${g}, ${b}, 0.2)`);
            localStorage.setItem('gardenTheme', color);
            grantAchievement('artist');
        }

        // --- MODAL ---
        function openAddModal() { 
            document.getElementById('newTitle').value = ""; // Fix: Clear input
            document.getElementById('newUrl').value = "";   // Fix: Clear input
            document.getElementById('addModal').classList.add('open'); 
        }

        function closeAddModal() { document.getElementById('addModal').classList.remove('open'); }
        
        function saveGame() {
            const titleInput = document.getElementById('newTitle');
            const urlInput = document.getElementById('newUrl');
            const title = titleInput.value.trim();
            const url = urlInput.value.trim();
            
            if(title && url) {
                const newGame = { title, url };
                games.push(newGame);
                
                const currentCustom = JSON.parse(localStorage.getItem('gardenGames') || '[]');
                currentCustom.push(newGame);
                localStorage.setItem('gardenGames', JSON.stringify(currentCustom));
                
                renderGames();
                closeAddModal();
            }
        }

        // --- RESET LOGIC ---
        function openResetModal() {
            document.getElementById('resetModal').classList.add('open');
        }
        function closeResetModal() {
            document.getElementById('resetModal').classList.remove('open');
        }
        function performReset() {
            localStorage.clear();
            location.reload();
        }

        document.getElementById('searchInput').addEventListener('input', (e) => renderGames());

        init();

    </script>
</body>
</html>
